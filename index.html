<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>上海月子会所初步分析报告 · 可视版</title>
<style>
  :root{
    --bg:#0b1020; --card:#121a31; --card2:#0e162b; --ink:#e8eefc; --muted:#9fb2d9; --accent:#7aa2ff; --good:#36d399; --warn:#fbbf24; --bad:#f43f5e; --mid:#60a5fa;
  }
  *{box-sizing:border-box}
  body{margin:0;background:linear-gradient(180deg,#0b1020,#0a0f1f);color:var(--ink);font:16px/1.6 ui-sans-serif,system-ui,-apple-system,Segoe UI,Helvetica,Arial,sans-serif}
  .wrap{max-width:1100px;margin:0 auto;padding:32px}
  header{display:flex;gap:16px;align-items:center;justify-content:space-between;margin-bottom:20px}
  .title{font-size:28px;font-weight:800;letter-spacing:.3px}
  .pill{font-size:13px;color:#0b1020;background:var(--accent);padding:6px 10px;border-radius:999px}
  .grid{display:grid;gap:16px}
  .g-2{grid-template-columns:repeat(2,minmax(0,1fr))}
  .g-3{grid-template-columns:repeat(3,minmax(0,1fr))}
  @media (max-width:900px){.g-2,.g-3{grid-template-columns:1fr}}
  .card{background:radial-gradient(1200px 400px at 10% -10%,#1a2550 0%,transparent 40%),linear-gradient(180deg,var(--card),var(--card2));border:1px solid #1c2642;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.35);padding:18px}
  h2{font-size:20px;margin:0 0 8px 0}
  h3{font-size:16px;margin:12px 0 8px 0;color:var(--muted);font-weight:700}
  .tag{display:inline-flex;align-items:center;gap:6px;padding:4px 8px;border-radius:999px;font-size:12px;background:#0e1b38;color:var(--muted);border:1px solid #1f2d52}
  .legend{display:flex;gap:8px;flex-wrap:wrap}
  .badge{display:inline-flex;align-items:center;justify-content:center;width:28px;height:28px;border-radius:50%;font-weight:800}
  .A{background:rgba(54,211,153,.15);border:1px solid var(--good);color:var(--good)}
  .B{background:rgba(96,165,250,.15);border:1px solid var(--mid);color:var(--mid)}
  .C{background:rgba(251,191,36,.15);border:1px solid var(--warn);color:var(--warn)}
  .D{background:rgba(244,63,94,.15);border:1px solid var(--bad);color:var(--bad)}
  table{width:100%;border-collapse:collapse;border-spacing:0}
  th,td{padding:10px 12px;border-bottom:1px dashed #203158;vertical-align:top}
  th{color:#bcd0ff;text-align:left;background:#0e162c;position:sticky;top:0}
  .kpi{display:flex;gap:8px;flex-wrap:wrap;margin:6px 0}
  .kpi .chip{background:#0d1a33;border:1px solid #1f2f57;color:#c8d6ff;border-radius:999px;padding:3px 8px;font-size:12px}
  .muted{color:var(--muted)}
  .route{counter-reset:step}
  .route li{list-style:none;margin:10px 0;padding:10px;border:1px dashed #2a3b66;border-radius:12px;background:#0c1429}
  .route li b::before{counter-increment:step;content:counter(step)'. ';}
  .addr{font-family:ui-monospace,Menlo,Consolas,monospace;color:#c7d2fe}
  footer{margin:28px 0 8px;color:#9fb2d9;font-size:13px}
  .center-cards{display:grid;gap:16px}
  .center-card{background:#0e162b;border:1px solid #1f2d57;border-radius:12px;padding:16px;transition:all 0.2s}
  .center-card:hover{background:#121a31;border-color:var(--accent)}
  .center-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;padding-bottom:8px;border-bottom:1px solid #1f2d57}
  .center-header h3{margin:0;font-size:16px;font-weight:700}
  .center-info{display:grid;gap:8px}
  .info-item{display:flex;flex-direction:column;gap:4px}
  .info-item .label{font-size:12px;color:var(--muted);font-weight:600}
  .info-item .addr{font-family:ui-monospace,Menlo,Consolas,monospace;color:#c7d2fe;font-size:13px}
  @media (min-width:768px){.center-cards{grid-template-columns:repeat(2,1fr)}}
  @media (min-width:1200px){.center-cards{grid-template-columns:repeat(3,1fr)}}
</style>
  <!-- 使用本地Chart.js或备用CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // 备用CDN，如果主CDN加载失败
    if (typeof Chart === 'undefined') {
      const script = document.createElement('script');
      script.src = 'https://unpkg.com/chart.js@4.4.0/dist/chart.umd.js';
      document.head.appendChild(script);
    }
  </script>
  <script>
    // 确保Chart.js加载完成
    let chartLoadAttempts = 0;
    const maxAttempts = 50; // 5秒超时

    function waitForChart() {
      console.log('等待Chart.js加载...', typeof Chart, '尝试次数:', chartLoadAttempts);
      
      if (typeof Chart !== 'undefined') {
        console.log('Chart.js已加载，开始初始化雷达图');
        initRadarChart();
      } else {
        chartLoadAttempts++;
        if (chartLoadAttempts >= maxAttempts) {
          console.log('Chart.js加载超时，显示备用内容');
          showFallbackContent();
        } else {
          console.log('Chart.js未加载，100ms后重试');
          setTimeout(waitForChart, 100);
        }
      }
    }

    // 添加一个简单的测试函数
    function testChart() {
      console.log('测试Chart.js功能...');
      if (typeof Chart !== 'undefined') {
        console.log('Chart.js可用');
        return true;
      } else {
        console.log('Chart.js不可用');
        return false;
      }
    }

    // 重试加载图表
    function retryLoadChart() {
      console.log('手动重试加载图表...');
      document.getElementById('chartLoading').innerHTML = `
        <div style="text-align: center;">
          <div style="font-size: 24px; margin-bottom: 8px;">📊</div>
          <div>正在重新加载图表...</div>
          <button onclick="retryLoadChart()" style="margin-top: 12px; padding: 8px 16px; background: var(--accent); color: #0b1020; border: none; border-radius: 6px; font-size: 12px; cursor: pointer;">🔄 重新加载</button>
        </div>
      `;
      waitForChart();
    }

    // 显示备用内容（如果Chart.js完全无法加载）
    function showFallbackContent() {
      console.log('显示备用内容...');
      const radarData = getRadarData();
      const centerNames = radarData.datasets.map(dataset => dataset.label);
      const scores = radarData.datasets.map(dataset => {
        const avg = (dataset.data.reduce((a, b) => a + b, 0) / dataset.data.length).toFixed(1);
        return `${dataset.label}: ${avg}分`;
      });

      document.getElementById('chartLoading').innerHTML = `
        <div style="text-align: center;">
          <div style="font-size: 24px; margin-bottom: 8px;">📊</div>
          <div style="margin-bottom: 16px;">图表加载失败，显示评分摘要</div>
          <div style="text-align: left; max-width: 400px; margin: 0 auto;">
            ${scores.map(score => `<div style="margin: 8px 0; padding: 8px; background: rgba(122, 162, 255, 0.1); border-radius: 6px;">${score}</div>`).join('')}
          </div>
          <button onclick="retryLoadChart()" style="margin-top: 16px; padding: 8px 16px; background: var(--accent); color: #0b1020; border: none; border-radius: 6px; font-size: 12px; cursor: pointer;">🔄 重试加载图表</button>
        </div>
      `;
    }
  </script>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="title">上海月子会所初步分析报告 · 可视版</div>
      <div class="pill">AI 初步调查 · 2025-08</div>
    </header>

    <div class="grid g-3">
      <div class="card">
        <h2>研究背景</h2>
        <p class="muted">围绕虹口区周边 6 家会所，整合公开资料（招聘 JD、价格带、地址、媒体与用户口碑）形成访问前对照底稿；供实地走访时边看边记。</p>
        <div class="legend" aria-label="评级图例">
          <span class="tag">评级含义：</span>
          <div style="margin-top: 8px;">
            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
              <span class="badge A">A</span><span class="muted">医疗背书强/透明度高/风险低</span>
            </div>
            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
              <span class="badge B">B</span><span class="muted">条件较好，个别项待核实</span>
            </div>
            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
              <span class="badge C">C</span><span class="muted">信息有限/执行需验证</span>
            </div>
            <div style="display: flex; align-items: center; gap: 8px;">
              <span class="badge D">D</span><span class="muted">透明度低/首访谨慎</span>
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <h2>目标清单</h2>
        <div class="kpi">
          <span class="chip">Jinen Xuan（锦恩·萱）</span>
          <span class="chip">Yueya Wan（月芽湾）</span>
          <span class="chip">Xing Yaolan（星摇篮）</span>
          <span class="chip">United Family（和睦家）</span>
          <span class="chip">Moli Zhihui（茉莉智慧）</span>
          <span class="chip">Bella ISLA Aiyu（艾屿）</span>
        </div>
        <p class="muted">注：价格为 28 天档的用户/媒体参考价；合同与实际套餐以门店为准。</p>
      </div>

      <div class="card">
        <h2>访问关注点</h2>
        <ul class="muted">
          <li>索要护士长/护士 JD 与执业证样例，确认是否要求公立医院履历</li>
          <li>查看排班表：宣称的“24h 1v1”是否可落地（夜班/节假日）</li>
          <li>医生查房频次、急救 SOP、转诊通道</li>
          <li>价格与条款：退订/改期/隐形收费</li>
        </ul>
      </div>
    </div>

    <section class="card" style="margin-top:16px">
      <h2>横评总表</h2>
      <div class="center-cards">
        <!-- United Family -->
        <div class="center-card">
          <div class="center-header">
            <h3>United Family（和睦家）</h3>
            <span class="badge A">A</span>
          </div>
          <div class="center-info">
            <div class="info-item">
              <span class="label">📍 地址：</span>
              <span class="addr">长宁区 平塘路699号</span>
            </div>
            <div class="info-item">
              <span class="label">💰 价格：</span>
              <span>TBD（高）</span>
            </div>
            <div class="info-item">
              <span class="label">🏥 医疗透明度：</span>
              <span>高（岗位公开、制度完善）</span>
            </div>
            <div class="info-item">
              <span class="label">👩‍⚕️ 执业要求：</span>
              <span>明确要求医院经验、注册护士执照</span>
            </div>
            <div class="info-item">
              <span class="label">🏨 医疗背书：</span>
              <span>医院体系、标准化查房</span>
            </div>
            <div class="info-item">
              <span class="label">⚠️ 风险要点：</span>
              <span>医疗安全系数高，费用偏高</span>
            </div>
          </div>
        </div>

        <!-- Moli Zhihui -->
        <div class="center-card">
          <div class="center-header">
            <h3>Moli Zhihui（茉莉智慧）</h3>
            <span class="badge B">B</span>
          </div>
          <div class="center-info">
            <div class="info-item">
              <span class="label">📍 地址：</span>
              <span class="addr">浦东新区 银城中路600弄 中粮海景壹号 5–7号楼</span>
            </div>
            <div class="info-item">
              <span class="label">💰 价格：</span>
              <span>¥190k–209k</span>
            </div>
            <div class="info-item">
              <span class="label">🏥 医疗透明度：</span>
              <span>中（产康岗位较多）</span>
            </div>
            <div class="info-item">
              <span class="label">👩‍⚕️ 执业要求：</span>
              <span>未见硬性"医院履历"字样</span>
            </div>
            <div class="info-item">
              <span class="label">🏨 医疗背书：</span>
              <span>宣称"智慧/数据化护理"（需核实）</span>
            </div>
            <div class="info-item">
              <span class="label">⚠️ 风险要点：</span>
              <span>高端口碑+高价，核实性价比</span>
            </div>
          </div>
        </div>

        <!-- Jinen Xuan -->
        <div class="center-card">
          <div class="center-header">
            <h3>Jinen Xuan（锦恩·萱）</h3>
            <span class="badge B">B</span>
          </div>
          <div class="center-info">
            <div class="info-item">
              <span class="label">📍 地址：</span>
              <span class="addr">徐汇区 衡山路12号 华邑酒店 2–6楼</span>
            </div>
            <div class="info-item">
              <span class="label">💰 价格：</span>
              <span>¥120k–180k</span>
            </div>
            <div class="info-item">
              <span class="label">🏥 医疗透明度：</span>
              <span>中（品牌与模式清晰）</span>
            </div>
            <div class="info-item">
              <span class="label">👩‍⚕️ 执业要求：</span>
              <span>执业证隐含；医院履历未明示</span>
            </div>
            <div class="info-item">
              <span class="label">🏨 医疗背书：</span>
              <span>宣称 24h 1v1（到店核实）</span>
            </div>
            <div class="info-item">
              <span class="label">⚠️ 风险要点：</span>
              <span>高端定位，重验证落地执行</span>
            </div>
          </div>
        </div>

        <!-- Bella ISLA Aiyu -->
        <div class="center-card">
          <div class="center-header">
            <h3>Bella ISLA Aiyu（艾屿 / SAINT BELLA）</h3>
            <span class="badge C">C</span>
          </div>
          <div class="center-info">
            <div class="info-item">
              <span class="label">📍 地址：</span>
              <span class="addr">长宁区 临虹路7号 阿纳迪酒店 9楼</span>
            </div>
            <div class="info-item">
              <span class="label">💰 价格：</span>
              <span>高（10万+）</span>
            </div>
            <div class="info-item">
              <span class="label">🏥 医疗透明度：</span>
              <span>中低（集团信息较多，护理JD少）</span>
            </div>
            <div class="info-item">
              <span class="label">👩‍⚕️ 执业要求：</span>
              <span>未见硬性要求</span>
            </div>
            <div class="info-item">
              <span class="label">🏨 医疗背书：</span>
              <span>宣称 1v1 护理团队</span>
            </div>
            <div class="info-item">
              <span class="label">⚠️ 风险要点：</span>
              <span>奢侈定位，用户实评稀少</span>
            </div>
          </div>
        </div>

        <!-- Xing Yaolan -->
        <div class="center-card">
          <div class="center-header">
            <h3>Xing Yaolan（星摇篮）</h3>
            <span class="badge C">C</span>
          </div>
          <div class="center-info">
            <div class="info-item">
              <span class="label">📍 地址：</span>
              <span class="addr">杨浦区 安波路467弄 法朵公寓12楼 1201–1214室</span>
            </div>
            <div class="info-item">
              <span class="label">💰 价格：</span>
              <span>¥56.9k–57k</span>
            </div>
            <div class="info-item">
              <span class="label">🏥 医疗透明度：</span>
              <span>低–中（连锁存在感，JD稀少）</span>
            </div>
            <div class="info-item">
              <span class="label">👩‍⚕️ 执业要求：</span>
              <span>N/A</span>
            </div>
            <div class="info-item">
              <span class="label">🏨 医疗背书：</span>
              <span>宣称 1v1 护理（需核实）</span>
            </div>
            <div class="info-item">
              <span class="label">⚠️ 风险要点：</span>
              <span>照片多评论少，合同细则要看</span>
            </div>
          </div>
        </div>

        <!-- Yueya Wan -->
        <div class="center-card">
          <div class="center-header">
            <h3>Yueya Wan（月芽湾）</h3>
            <span class="badge D">D</span>
          </div>
          <div class="center-info">
            <div class="info-item">
              <span class="label">📍 地址：</span>
              <span class="addr">浦东新区 浦东大道1525号 西楼6楼</span>
            </div>
            <div class="info-item">
              <span class="label">💰 价格：</span>
              <span>¥58k–64k</span>
            </div>
            <div class="info-item">
              <span class="label">🏥 医疗透明度：</span>
              <span>低（护理信息公开少）</span>
            </div>
            <div class="info-item">
              <span class="label">👩‍⚕️ 执业要求：</span>
              <span>N/A</span>
            </div>
            <div class="info-item">
              <span class="label">🏨 医疗背书：</span>
              <span>未知</span>
            </div>
            <div class="info-item">
              <span class="label">⚠️ 风险要点：</span>
              <span>透明度低，首访谨慎</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="card" style="margin-top:16px">
      <h2>建议的自驾访问顺序（起点：虹口区 凉城路/广灵四路）</h2>
      <ol class="route">
        <li>
          <b>Xing Yaolan（星摇篮）</b><br>
          <span class="addr">杨浦区 安波路467弄 法朵公寓12楼 1201–1214室</span><br>
          <span class="muted">预计 10–15 分钟</span>
          <a href="https://uri.amap.com/navigation?to=121.5245,31.2594,星摇篮月子会所&mode=car&policy=1&src=mypage&coordinate=gaode&callnative=0" target="_blank" style="display: inline-block; margin-top: 8px; padding: 6px 12px; background: var(--accent); color: #0b1020; text-decoration: none; border-radius: 6px; font-size: 13px; font-weight: 600;">🚗 导航</a>
        </li>
        <li>
          <b>Jinen Xuan（锦恩·萱）</b><br>
          <span class="addr">徐汇区 衡山路12号 华邑酒店 2–6楼</span><br>
          <span class="muted">预计 20–25 分钟</span>
          <a href="https://uri.amap.com/navigation?to=121.4465,31.2089,锦恩萱月子会所&mode=car&policy=1&src=mypage&coordinate=gaode&callnative=0" target="_blank" style="display: inline-block; margin-top: 8px; padding: 6px 12px; background: var(--accent); color: #0b1020; text-decoration: none; border-radius: 6px; font-size: 13px; font-weight: 600;">🚗 导航</a>
        </li>
        <li>
          <b>Bella ISLA Aiyu（艾屿）</b><br>
          <span class="addr">长宁区 临虹路7号 阿纳迪酒店 9楼</span><br>
          <span class="muted">预计 15 分钟</span>
          <a href="https://uri.amap.com/navigation?to=121.4215,31.2189,艾屿月子会所&mode=car&policy=1&src=mypage&coordinate=gaode&callnative=0" target="_blank" style="display: inline-block; margin-top: 8px; padding: 6px 12px; background: var(--accent); color: #0b1020; text-decoration: none; border-radius: 6px; font-size: 13px; font-weight: 600;">🚗 导航</a>
        </li>
        <li>
          <b>United Family（和睦家）</b><br>
          <span class="addr">长宁区 平塘路699号</span><br>
          <span class="muted">预计 10 分钟</span>
          <a href="https://uri.amap.com/navigation?to=121.4085,31.2189,和睦家月子会所&mode=car&policy=1&src=mypage&coordinate=gaode&callnative=0" target="_blank" style="display: inline-block; margin-top: 8px; padding: 6px 12px; background: var(--accent); color: #0b1020; text-decoration: none; border-radius: 6px; font-size: 13px; font-weight: 600;">🚗 导航</a>
        </li>
        <li>
          <b>Moli Zhihui（茉莉智慧）</b><br>
          <span class="addr">浦东新区 银城中路600弄 中粮海景壹号 5–7号楼</span><br>
          <span class="muted">预计 20–25 分钟</span>
          <a href="https://uri.amap.com/navigation?to=121.5085,31.2389,茉莉智慧月子会所&mode=car&policy=1&src=mypage&coordinate=gaode&callnative=0" target="_blank" style="display: inline-block; margin-top: 8px; padding: 6px 12px; background: var(--accent); color: #0b1020; text-decoration: none; border-radius: 6px; font-size: 13px; font-weight: 600;">🚗 导航</a>
        </li>
        <li>
          <b>Yueya Wan（月芽湾）</b><br>
          <span class="addr">浦东新区 浦东大道1525号 西楼6楼</span><br>
          <span class="muted">预计 15 分钟</span>
          <a href="https://uri.amap.com/navigation?to=121.5285,31.2389,月芽湾月子会所&mode=car&policy=1&src=mypage&coordinate=gaode&callnative=0" target="_blank" style="display: inline-block; margin-top: 8px; padding: 6px 12px; background: var(--accent); color: #0b1020; text-decoration: none; border-radius: 6px; font-size: 13px; font-weight: 600;">🚗 导航</a>
        </li>
      </ol>
      <p class="muted">每家建议预留 40–60 分钟；午间在长宁或徐汇补给休息，避开跨江高峰。</p>
    </section>

    <section class="card" style="margin-top:16px">
      <h2>评价雷达图</h2>
      <p class="muted" id="radarDescription">基于医疗资质透明度、护理团队专业度、环境与硬件质量等维度的AI初步评分</p>
      <div style="position: relative; height: 400px; max-width: 600px; margin: 0 auto;">
        <div id="chartLoading" style="display: flex; align-items: center; justify-content: center; height: 100%; color: var(--muted);">
          <div style="text-align: center;">
            <div style="font-size: 24px; margin-bottom: 8px;">📊</div>
            <div>正在加载图表...</div>
            <button onclick="retryLoadChart()" style="margin-top: 12px; padding: 8px 16px; background: var(--accent); color: #0b1020; border: none; border-radius: 6px; font-size: 12px; cursor: pointer;">🔄 重新加载</button>
          </div>
        </div>
        <canvas id="radarChart" style="display: none;"></canvas>
      </div>
    </section>



    <footer>说明：本页为 AI 基于公开资料的初步调查，不构成医疗或合同建议。最终选择以你们的实地考察与合同条款为准。</footer>
    
    <!-- 开始评分按钮 -->
    <div style="text-align: center; margin-top: 32px; padding: 20px;">
      <a href="scoring.html" class="btn btn-primary" style="display: inline-flex; align-items: center; gap: 8px; padding: 16px 24px; background: var(--accent); color: #0b1020; text-decoration: none; border-radius: 12px; font-size: 16px; font-weight: 700; box-shadow: 0 8px 24px rgba(122, 162, 255, 0.3); transition: all 0.3s;">
        📊 开始实地评分
      </a>
      <p class="muted" style="margin-top: 12px; font-size: 14px;">点击进入评分页面，记录实地考察数据</p>
    </div>
  </div>

  <script>
    // 网络状态检测
    function checkNetworkStatus() {
      if (!navigator.onLine) {
        document.getElementById('chartLoading').innerHTML = `
          <div style="text-align: center; color: var(--warn);">
            <div style="font-size: 24px; margin-bottom: 8px;">⚠️</div>
            <div>网络连接异常，图表可能无法正常显示</div>
            <div style="font-size: 12px; margin-top: 8px;">请检查网络连接后刷新页面</div>
          </div>
        `;
        return false;
      }
      return true;
    }

    // AI初评分数据（3个维度）
    const aiRadarData = {
      labels: ['医疗资质透明度', '护理团队专业度', '环境与硬件质量'],
      datasets: [
        {
          label: 'United Family（和睦家）',
          data: [9, 8, 8],
          borderColor: '#e91e63',
          backgroundColor: 'rgba(233, 30, 99, 0.2)',
          borderWidth: 2,
          pointBackgroundColor: '#e91e63',
          pointBorderColor: '#fff',
          pointHoverBackgroundColor: '#fff',
          pointHoverBorderColor: '#e91e63'
        },
        {
          label: 'Jinen Xuan（锦恩·萱）',
          data: [7, 7, 8],
          borderColor: '#ff9800',
          backgroundColor: 'rgba(255, 152, 0, 0.2)',
          borderWidth: 2,
          pointBackgroundColor: '#ff9800',
          pointBorderColor: '#fff',
          pointHoverBackgroundColor: '#fff',
          pointHoverBorderColor: '#ff9800'
        },
        {
          label: 'Moli Zhihui（茉莉智慧）',
          data: [6, 7, 9],
          borderColor: '#00bcd4',
          backgroundColor: 'rgba(0, 188, 212, 0.2)',
          borderWidth: 2,
          pointBackgroundColor: '#00bcd4',
          pointBorderColor: '#fff',
          pointHoverBackgroundColor: '#fff',
          pointHoverBorderColor: '#00bcd4'
        },
        {
          label: 'Bella ISLA Aiyu（艾屿）',
          data: [5, 6, 8],
          borderColor: '#009688',
          backgroundColor: 'rgba(0, 150, 136, 0.2)',
          borderWidth: 2,
          pointBackgroundColor: '#009688',
          pointBorderColor: '#fff',
          pointHoverBackgroundColor: '#fff',
          pointHoverBorderColor: '#009688'
        },
        {
          label: 'Xing Yaolan（星摇篮）',
          data: [4, 5, 6],
          borderColor: '#f44336',
          backgroundColor: 'rgba(244, 67, 54, 0.2)',
          borderWidth: 2,
          pointBackgroundColor: '#f44336',
          pointBorderColor: '#fff',
          pointHoverBackgroundColor: '#fff',
          pointHoverBorderColor: '#f44336'
        },
        {
          label: 'Yueya Wan（月芽湾）',
          data: [3, 5, 5],
          borderColor: '#795548',
          backgroundColor: 'rgba(121, 85, 72, 0.2)',
          borderWidth: 2,
          pointBackgroundColor: '#795548',
          pointBorderColor: '#fff',
          pointHoverBackgroundColor: '#fff',
          pointHoverBorderColor: '#795548'
        }
      ]
    };

    // 获取实地评分数据
    function getFieldScores() {
      try {
        const savedData = localStorage.getItem('maternityCenterScores');
        if (savedData) {
          const scoreHistory = JSON.parse(savedData);
          if (scoreHistory.length > 0) {
            // 计算每个会所的最新评分
            const centerScores = {};
            scoreHistory.forEach(record => {
              if (!centerScores[record.center] || record.timestamp > centerScores[record.center].timestamp) {
                centerScores[record.center] = record;
              }
            });

            // 转换为10维雷达图数据
            const colors = ['#e91e63', '#ff9800', '#00bcd4', '#009688', '#f44336', '#795548'];
            const datasets = Object.values(centerScores).map((record, index) => ({
              label: record.center,
              data: [
                record.nursing, record.environment, record.medical, record.food, record.babyCare,
                record.service, record.cleanliness, record.crowding || 5, record.specialService, record.reception
              ],
              borderColor: colors[index % colors.length],
              backgroundColor: colors[index % colors.length] + '20',
              borderWidth: 2,
              pointBackgroundColor: colors[index % colors.length],
              pointBorderColor: '#fff',
              pointHoverBackgroundColor: '#fff',
              pointHoverBorderColor: colors[index % colors.length]
            }));

            return {
              labels: ['护理团队专业度', '环境与硬件质量', '医疗实力/对接度', '月子餐与营养管理', '婴儿护理与标准化程度', 
                      '客服与服务体验', '清洁与卫生', '拥挤度与私密性', '特色服务与附加价值', '产妇综合印象'],
              datasets: datasets
            };
          }
        }
      } catch (error) {
        console.error('获取实地评分数据失败:', error);
      }
      return null;
    }

    // 动态雷达图数据
    function getRadarData() {
      const fieldScores = getFieldScores();
      if (fieldScores) {
        // 更新说明文字
        document.getElementById('radarDescription').innerHTML = 
          '基于实地考察的10个维度评分数据（包含护理专业度、环境质量、医疗实力、餐食营养管理等）';
        return fieldScores;
      } else {
        // 更新说明文字
        document.getElementById('radarDescription').innerHTML = 
          '基于医疗资质透明度、护理团队专业度、环境与硬件质量等维度的AI初步评分';
        return aiRadarData;
      }
    }

    // 雷达图配置
    function getRadarConfig(data) {
      return {
        type: 'radar',
        data: data,
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'top',
              labels: {
                color: '#e8eefc',
                font: {
                  size: data.labels.length > 5 ? 10 : 12
                },
                usePointStyle: true,
                padding: 15
              }
            },
            title: {
              display: false
            }
          },
          scales: {
            r: {
              beginAtZero: true,
              max: 10,
              min: 0,
              ticks: {
                display: false
              },
              grid: {
                color: 'rgba(159, 178, 217, 0.2)'
              },
              angleLines: {
                color: 'rgba(159, 178, 217, 0.3)'
              },
              pointLabels: {
                color: '#bcd0ff',
                font: {
                  size: data.labels.length > 5 ? 11 : 13,
                  weight: '600'
                }
              }
            }
          },
          elements: {
            point: {
              radius: 4,
              hoverRadius: 6
            }
          }
        }
      };
    }

    // 等待Chart.js加载完成后创建雷达图
    function initRadarChart() {
      console.log('开始初始化雷达图...');
      
      if (typeof Chart === 'undefined') {
        console.log('Chart.js未加载，等待...');
        setTimeout(initRadarChart, 100);
        return;
      }

      try {
        const ctx = document.getElementById('radarChart');
        if (!ctx) {
          console.error('找不到雷达图画布元素');
          return;
        }

        console.log('获取雷达图数据...');
        const radarData = getRadarData();
        console.log('雷达图数据:', radarData);
        
        const radarConfig = getRadarConfig(radarData);
        console.log('雷达图配置:', radarConfig);

        const chartCanvas = ctx.getContext('2d');
        const chart = new Chart(chartCanvas, radarConfig);
        
        console.log('雷达图创建成功');
        
        // 隐藏加载状态，显示图表
        document.getElementById('chartLoading').style.display = 'none';
        ctx.style.display = 'block';
        
      } catch (error) {
        console.error('雷达图初始化失败:', error);
        document.getElementById('chartLoading').innerHTML = `
          <div style="text-align: center; color: var(--bad);">
            <div style="font-size: 24px; margin-bottom: 8px;">❌</div>
            <div>图表加载失败: ${error.message}</div>
            <div style="font-size: 12px; margin-top: 8px;">请刷新页面重试</div>
          </div>
        `;
      }
    }

    // 页面加载完成后初始化雷达图
    document.addEventListener('DOMContentLoaded', function() {
      console.log('页面加载完成，开始初始化...');
      // 检查网络状态
      if (checkNetworkStatus()) {
        // 使用waitForChart函数确保Chart.js加载完成
        waitForChart();
      }
    });

    // 确保在页面加载完成后初始化
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', function() {
        console.log('页面加载完成，开始初始化...');
        if (checkNetworkStatus()) {
          waitForChart();
        }
      });
    } else {
      console.log('页面已加载，直接初始化...');
      if (checkNetworkStatus()) {
        waitForChart();
      }
    }

    // 网络状态变化时重新检查
    window.addEventListener('online', function() {
      if (document.getElementById('chartLoading').style.display !== 'none') {
        initRadarChart();
      }
    });

    // 页面获得焦点时检查是否有新的评分数据
    window.addEventListener('focus', function() {
      // 如果图表已经显示，检查是否需要更新
      const chartCanvas = document.getElementById('radarChart');
      if (chartCanvas && chartCanvas.style.display !== 'none') {
        const currentData = getRadarData();
        const existingChart = Chart.getChart(chartCanvas);
        
        if (existingChart) {
          // 检查数据是否有变化
          const hasFieldScores = getFieldScores() !== null;
          const currentLabels = existingChart.data.labels;
          const shouldUpdate = (hasFieldScores && currentLabels.length === 3) || 
                              (!hasFieldScores && currentLabels.length === 10);
          
          if (shouldUpdate) {
            // 销毁旧图表，创建新图表
            existingChart.destroy();
            initRadarChart();
          }
        }
      }
    });
  </script>
</body>
</html>
