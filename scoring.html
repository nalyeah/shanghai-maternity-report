<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>å®åœ°è¯„åˆ†è®°å½• Â· ä¸Šæµ·æœˆå­ä¼šæ‰€</title>
<style>
  :root{
    --bg:#0b1020; --card:#121a31; --card2:#0e162b; --ink:#e8eefc; --muted:#9fb2d9; --accent:#7aa2ff; --good:#36d399; --warn:#fbbf24; --bad:#f43f5e; --mid:#60a5fa;
  }
  *{box-sizing:border-box}
  body{margin:0;background:linear-gradient(180deg,#0b1020,#0a0f1f);color:var(--ink);font:16px/1.6 ui-sans-serif,system-ui,-apple-system,Segoe UI,Helvetica,Arial,sans-serif}
  .wrap{max-width:1200px;margin:0 auto;padding:20px}
  @media (max-width:768px){.wrap{padding:12px}}
  header{display:flex;gap:16px;align-items:center;justify-content:space-between;margin-bottom:20px}
  .title{font-size:24px;font-weight:800;letter-spacing:.3px}
  @media (max-width:768px){.title{font-size:20px}}
  .pill{font-size:13px;color:#0b1020;background:var(--accent);padding:6px 10px;border-radius:999px}
  .grid{display:grid;gap:16px}
  .g-2{grid-template-columns:repeat(2,minmax(0,1fr))}
  .g-3{grid-template-columns:repeat(3,minmax(0,1fr))}
  @media (max-width:900px){.g-2,.g-3{grid-template-columns:1fr}}
  .card{background:radial-gradient(1200px 400px at 10% -10%,#1a2550 0%,transparent 40%),linear-gradient(180deg,var(--card),var(--card2));border:1px solid #1c2642;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.35);padding:18px}
  h2{font-size:20px;margin:0 0 8px 0}
  h3{font-size:16px;margin:12px 0 8px 0;color:var(--muted);font-weight:700}
  .tag{display:inline-flex;align-items:center;gap:6px;padding:4px 8px;border-radius:999px;font-size:12px;background:#0e1b38;color:var(--muted);border:1px solid #1f2d52}
  .legend{display:flex;gap:8px;flex-wrap:wrap}
  .badge{display:inline-flex;align-items:center;justify-content:center;width:28px;height:28px;border-radius:50%;font-weight:800}
  .A{background:rgba(54,211,153,.15);border:1px solid var(--good);color:var(--good)}
  .B{background:rgba(96,165,250,.15);border:1px solid var(--mid);color:var(--mid)}
  .C{background:rgba(251,191,36,.15);border:1px solid var(--warn);color:var(--warn)}
  .D{background:rgba(244,63,94,.15);border:1px solid var(--bad);color:var(--bad)}
  .muted{color:var(--muted)}
  .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 16px;border:none;border-radius:8px;font-size:14px;font-weight:600;cursor:pointer;text-decoration:none;transition:all 0.2s}
  .btn-primary{background:var(--accent);color:#0b1020}
  .btn-secondary{background:#1f2d57;color:var(--ink);border:1px solid #2a3b66}
  .btn-danger{background:var(--bad);color:#fff}
  .btn:hover{transform:translateY(-1px);box-shadow:0 4px 12px rgba(0,0,0,.3)}
  .btn:active{transform:translateY(0)}
  .btn-group{display:flex;gap:8px;flex-wrap:wrap}
  .score-input{display:flex;align-items:center;gap:12px;margin:12px 0}
  .score-input label{min-width:120px;font-weight:600}
  @media (max-width:768px){
    .score-input{flex-direction:column;align-items:stretch;gap:8px}
    .score-input label{min-width:auto;font-size:14px}
    .score-input input[type="range"]{width:100%}
    .score-value{text-align:center;margin-top:4px}
  }
  .score-input input[type="range"]{flex:1;height:6px;background:#1f2d57;border-radius:3px;outline:none}
  .score-input input[type="range"]::-webkit-slider-thumb{appearance:none;width:20px;height:20px;background:var(--accent);border-radius:50%;cursor:pointer}
  .score-input input[type="range"]::-moz-range-thumb{width:20px;height:20px;background:var(--accent);border-radius:50%;cursor:pointer;border:none}
  .score-value{min-width:30px;text-align:center;font-weight:700;color:var(--accent)}
  .notes{width:100%;min-height:80px;background:#0e162b;border:1px solid #1f2d57;border-radius:8px;padding:12px;color:var(--ink);font-family:inherit;resize:vertical}
  .notes:focus{outline:none;border-color:var(--accent)}
  .history-item{background:#0e162b;border:1px solid #1f2d57;border-radius:8px;padding:12px;margin:8px 0;cursor:pointer;transition:all 0.2s}
  .history-item:hover{background:#121a31;border-color:var(--accent)}
  .history-item.active{background:rgba(122,162,255,.1);border-color:var(--accent)}
  .history-time{font-size:12px;color:var(--muted);margin-bottom:4px}
  .history-summary{font-size:14px;color:var(--ink)}
  .empty-state{text-align:center;padding:40px 20px;color:var(--muted)}
  .empty-state .icon{font-size:48px;margin-bottom:16px}
  .toast{position:fixed;top:20px;right:20px;background:var(--good);color:#0b1020;padding:12px 16px;border-radius:8px;font-weight:600;z-index:1000;transform:translateX(100%);transition:transform 0.3s}
  .toast.show{transform:translateX(0)}
  .toast.error{background:var(--bad);color:#fff}
  .ranking-item{display:flex;align-items:center;gap:16px;padding:16px;background:#0e162b;border:1px solid #1f2d57;border-radius:12px;margin:8px 0;transition:all 0.2s}
  .ranking-item:hover{background:#121a31;border-color:var(--accent)}
  .ranking-item.gold{border-color:#ffd700;background:linear-gradient(135deg,rgba(255,215,0,.1),rgba(255,215,0,.05))}
  .ranking-item.silver{border-color:#c0c0c0;background:linear-gradient(135deg,rgba(192,192,192,.1),rgba(192,192,192,.05))}
  .ranking-item.bronze{border-color:#cd7f32;background:linear-gradient(135deg,rgba(205,127,50,.1),rgba(205,127,50,.05))}
  .rank-number{display:flex;align-items:center;justify-content:center;width:40px;height:40px;border-radius:50%;font-weight:800;font-size:18px;flex-shrink:0}
  .rank-number.gold{background:#ffd700;color:#0b1020}
  .rank-number.silver{background:#c0c0c0;color:#0b1020}
  .rank-number.bronze{background:#cd7f32;color:#fff}
  .rank-number.other{background:#1f2d57;color:var(--ink)}
  .ranking-info{flex:1}
  .ranking-title{font-size:16px;font-weight:700;margin-bottom:4px}
  .ranking-score{font-size:14px;color:var(--muted)}
  .ranking-details{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  .score-tag{background:#0d1a33;border:1px solid #1f2f57;color:#c8d6ff;border-radius:999px;padding:2px 6px;font-size:11px}
  .score-tag.high{background:rgba(54,211,153,.15);border-color:var(--good);color:var(--good)}
  .score-tag.medium{background:rgba(96,165,250,.15);border-color:var(--mid);color:var(--mid)}
  .score-tag.low{background:rgba(244,63,94,.15);border-color:var(--bad);color:var(--bad)}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div style="display: flex; align-items: center; gap: 16px;">
        <a href="index.html" class="btn btn-secondary" style="padding: 8px 12px; font-size: 14px;">â† è¿”å›æŠ¥å‘Š</a>
        <div class="title">å®åœ°è¯„åˆ†è®°å½•</div>
      </div>
      <div class="pill">å®æ—¶è¯„åˆ† Â· åŠ¨æ€é›·è¾¾å›¾</div>
    </header>

    <div class="grid g-2">
      <!-- è¯„åˆ†è¡¨å• -->
      <div class="card">
        <h2>è¯„åˆ†è¡¨å•</h2>
        <div style="margin-bottom:16px">
          <label style="display:block;margin-bottom:8px;font-weight:600;">é€‰æ‹©ä¼šæ‰€ï¼š</label>
          <select id="centerSelect" style="width:100%;padding:8px 12px;background:#0e162b;border:1px solid #1f2d57;border-radius:6px;color:var(--ink);font-size:14px;">
            <option value="">è¯·é€‰æ‹©ä¼šæ‰€...</option>
            <option value="Jinen Xuan">Jinen Xuanï¼ˆé”¦æ©Â·è±ï¼‰</option>
            <option value="Yueya Wan">Yueya Wanï¼ˆæœˆèŠ½æ¹¾ï¼‰</option>
            <option value="Xing Yaolan">Xing Yaolanï¼ˆæ˜Ÿæ‘‡ç¯®ï¼‰</option>
            <option value="United Family">United Familyï¼ˆå’Œç¦å®¶ï¼‰</option>
            <option value="Moli Zhihui">Moli Zhihuiï¼ˆèŒ‰è‰æ™ºæ…§ï¼‰</option>
            <option value="Bella ISLA Aiyu">Bella ISLA Aiyuï¼ˆè‰¾å±¿ï¼‰</option>
          </select>
        </div>

                 <div id="scoreForm" style="display:none;">
           <div class="score-input">
             <label>åŒ»ç–—èµ„è´¨é€æ˜åº¦ï¼š</label>
             <input type="range" id="medicalScore" min="0" max="10" value="5" step="0.5">
             <span class="score-value" id="medicalValue">5</span>
           </div>
           <div class="score-input">
             <label>æŠ¤ç†å›¢é˜Ÿä¸“ä¸šåº¦ï¼š</label>
             <input type="range" id="nursingScore" min="0" max="10" value="5" step="0.5">
             <span class="score-value" id="nursingValue">5</span>
           </div>
           <div class="score-input">
             <label>ç¯å¢ƒä¸ç¡¬ä»¶è´¨é‡ï¼š</label>
             <input type="range" id="environmentScore" min="0" max="10" value="5" step="0.5">
             <span class="score-value" id="environmentValue">5</span>
           </div>
           <div class="score-input">
             <label>æœˆå­é¤å“è´¨ï¼š</label>
             <input type="range" id="foodScore" min="0" max="10" value="5" step="0.5">
             <span class="score-value" id="foodValue">5</span>
           </div>
           <div class="score-input">
             <label>å©´å„¿æŠ¤ç†æ ‡å‡†åŒ–ï¼š</label>
             <input type="range" id="babyCareScore" min="0" max="10" value="5" step="0.5">
             <span class="score-value" id="babyCareValue">5</span>
           </div>
           <div class="score-input">
             <label>å®¢æœä¸æœåŠ¡ä½“éªŒï¼š</label>
             <input type="range" id="serviceScore" min="0" max="10" value="5" step="0.5">
             <span class="score-value" id="serviceValue">5</span>
           </div>
           <div class="score-input">
             <label>åˆåŒé€æ˜åº¦ï¼š</label>
             <input type="range" id="contractScore" min="0" max="10" value="5" step="0.5">
             <span class="score-value" id="contractValue">5</span>
           </div>
           <div class="score-input">
             <label>æ¸…æ´ä¸å«ç”Ÿï¼š</label>
             <input type="range" id="cleanlinessScore" min="0" max="10" value="5" step="0.5">
             <span class="score-value" id="cleanlinessValue">5</span>
           </div>
           <div class="score-input">
             <label>ç‰¹è‰²æœåŠ¡ï¼š</label>
             <input type="range" id="specialServiceScore" min="0" max="10" value="5" step="0.5">
             <span class="score-value" id="specialServiceValue">5</span>
           </div>
           <div class="score-input">
             <label>æ¥å¾…å°è±¡åˆ†ï¼š</label>
             <input type="range" id="receptionScore" min="0" max="10" value="5" step="0.5">
             <span class="score-value" id="receptionValue">5</span>
           </div>

          <div style="margin-top:16px;">
            <label style="display:block;margin-bottom:8px;font-weight:600;">å®åœ°è§‚å¯Ÿç¬”è®°ï¼š</label>
            <textarea id="notes" class="notes" placeholder="è®°å½•å®åœ°è€ƒå¯Ÿçš„è¯¦ç»†è§‚å¯Ÿ..."></textarea>
          </div>

          <div class="btn-group" style="margin-top:16px;">
            <button class="btn btn-primary" onclick="saveScore()">ğŸ’¾ ä¿å­˜è¯„åˆ†</button>
            <button class="btn btn-secondary" onclick="resetForm()">ğŸ”„ é‡ç½®è¡¨å•</button>
            <button class="btn btn-danger" onclick="undoLast()">â†¶ æ’¤é”€ä¸Šæ¬¡</button>
          </div>
        </div>
      </div>

      <!-- å®æ—¶é›·è¾¾å›¾ -->
      <div class="card">
        <h2>å®æ—¶é›·è¾¾å›¾</h2>
        <div style="position: relative; height: 350px;">
          <canvas id="radarChart"></canvas>
        </div>
        <p class="muted" style="margin-top:12px;font-size:13px;">å›¾è¡¨å®æ—¶åæ˜ å½“å‰è¯„åˆ†æ•°æ®ï¼Œæ”¯æŒå¤šä¼šæ‰€å¯¹æ¯”</p>
      </div>
    </div>

    <!-- è¯„åˆ†å†å² -->
    <div class="card" style="margin-top:16px;">
      <h2>è¯„åˆ†å†å²</h2>
      <div id="historyList">
        <div class="empty-state">
          <div class="icon">ğŸ“</div>
          <div>æš‚æ— è¯„åˆ†è®°å½•</div>
          <div style="font-size:13px;margin-top:8px;">å¼€å§‹è¯„åˆ†åï¼Œå†å²è®°å½•å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</div>
        </div>
      </div>
    </div>

         <!-- å½“å‰æ’å -->
     <div class="card" style="margin-top:16px;">
       <h2>ğŸ† å½“å‰æ’å</h2>
       <div id="rankingList">
         <div class="empty-state">
           <div class="icon">ğŸ†</div>
           <div>æš‚æ— è¯„åˆ†æ•°æ®</div>
           <div style="font-size:13px;margin-top:8px;">å¼€å§‹è¯„åˆ†åï¼Œæ’åå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</div>
         </div>
       </div>
     </div>

     <!-- æ•°æ®å¯¼å‡º -->
     <div class="card" style="margin-top:16px;">
       <h2>æ•°æ®ç®¡ç†</h2>
       <div class="btn-group">
         <button class="btn btn-primary" onclick="exportData()">ğŸ“¤ å¯¼å‡ºæ•°æ®</button>
         <button class="btn btn-secondary" onclick="importData()">ğŸ“¥ å¯¼å…¥æ•°æ®</button>
         <button class="btn btn-danger" onclick="clearAllData()">ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰</button>
       </div>
       <input type="file" id="fileInput" accept=".json" style="display:none;" onchange="handleFileImport(event)">
     </div>
  </div>

  <!-- æç¤ºæ¡† -->
  <div id="toast" class="toast"></div>

  <!-- ä½¿ç”¨æœ¬åœ°Chart.jsæˆ–å¤‡ç”¨CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // å¤‡ç”¨CDNï¼Œå¦‚æœä¸»CDNåŠ è½½å¤±è´¥
  if (typeof Chart === 'undefined') {
    const script = document.createElement('script');
    script.src = 'https://unpkg.com/chart.js@4.4.0/dist/chart.umd.js';
    document.head.appendChild(script);
  }
</script>
  <script>
    // å…¨å±€å˜é‡
    let scoreHistory = [];
    let currentChart = null;
    let selectedCenter = '';

    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function() {
      loadData();
      initChart();
      setupEventListeners();
    });

    // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
    function setupEventListeners() {
      document.getElementById('centerSelect').addEventListener('change', function(e) {
        selectedCenter = e.target.value;
        if (selectedCenter) {
          document.getElementById('scoreForm').style.display = 'block';
        } else {
          document.getElementById('scoreForm').style.display = 'none';
        }
      });

             // æ»‘å—äº‹ä»¶
       ['medicalScore', 'nursingScore', 'environmentScore', 'foodScore', 'babyCareScore', 'serviceScore', 'contractScore', 'cleanlinessScore', 'specialServiceScore', 'receptionScore'].forEach(id => {
         const slider = document.getElementById(id);
         const value = document.getElementById(id.replace('Score', 'Value'));
         slider.addEventListener('input', function() {
           value.textContent = this.value;
           updateChart();
         });
       });
    }

    // åˆå§‹åŒ–é›·è¾¾å›¾
    function initChart() {
      const ctx = document.getElementById('radarChart').getContext('2d');
      currentChart = new Chart(ctx, {
        type: 'radar',
                 data: {
           labels: ['åŒ»ç–—èµ„è´¨é€æ˜åº¦', 'æŠ¤ç†å›¢é˜Ÿä¸“ä¸šåº¦', 'ç¯å¢ƒä¸ç¡¬ä»¶è´¨é‡', 'æœˆå­é¤å“è´¨', 'å©´å„¿æŠ¤ç†æ ‡å‡†åŒ–', 'å®¢æœä¸æœåŠ¡ä½“éªŒ', 'åˆåŒé€æ˜åº¦', 'æ¸…æ´ä¸å«ç”Ÿ', 'ç‰¹è‰²æœåŠ¡', 'æ¥å¾…å°è±¡åˆ†'],
           datasets: []
         },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'top',
              labels: {
                color: '#e8eefc',
                font: { size: 12 },
                usePointStyle: true,
                padding: 15
              }
            }
          },
          scales: {
            r: {
              beginAtZero: true,
              max: 10,
              min: 0,
              ticks: { display: false },
              grid: { color: 'rgba(159, 178, 217, 0.2)' },
              angleLines: { color: 'rgba(159, 178, 217, 0.3)' },
              pointLabels: {
                color: '#bcd0ff',
                font: { size: 13, weight: '600' }
              }
            }
          },
          elements: {
            point: { radius: 4, hoverRadius: 6 }
          }
        }
      });
    }

    // æ›´æ–°é›·è¾¾å›¾
    function updateChart() {
      if (!currentChart) return;

      const datasets = [];
      const colors = ['#ff9800', '#795548', '#f44336', '#e91e63', '#00bcd4', '#009688'];

      // æ·»åŠ å†å²æ•°æ®
      const centerData = {};
      scoreHistory.forEach(record => {
        if (!centerData[record.center]) {
          centerData[record.center] = record;
        }
      });

             Object.values(centerData).forEach((record, index) => {
         datasets.push({
           label: record.center,
           data: [record.medical, record.nursing, record.environment, record.food, record.babyCare, record.service, record.contract, record.cleanliness, record.specialService, record.reception],
           borderColor: colors[index % colors.length],
           backgroundColor: colors[index % colors.length] + '20',
           borderWidth: 2,
           pointBackgroundColor: colors[index % colors.length],
           pointBorderColor: '#fff',
           pointHoverBackgroundColor: '#fff',
           pointHoverBorderColor: colors[index % colors.length]
         });
       });

             // æ·»åŠ å½“å‰ç¼–è¾‘çš„æ•°æ®
       if (selectedCenter && document.getElementById('scoreForm').style.display !== 'none') {
         const currentData = {
           medical: parseFloat(document.getElementById('medicalScore').value),
           nursing: parseFloat(document.getElementById('nursingScore').value),
           environment: parseFloat(document.getElementById('environmentScore').value),
           food: parseFloat(document.getElementById('foodScore').value),
           babyCare: parseFloat(document.getElementById('babyCareScore').value),
           service: parseFloat(document.getElementById('serviceScore').value),
           contract: parseFloat(document.getElementById('contractScore').value),
           cleanliness: parseFloat(document.getElementById('cleanlinessScore').value),
           specialService: parseFloat(document.getElementById('specialServiceScore').value),
           reception: parseFloat(document.getElementById('receptionScore').value)
         };

         datasets.push({
           label: selectedCenter + ' (å½“å‰)',
           data: [currentData.medical, currentData.nursing, currentData.environment, currentData.food, currentData.babyCare, currentData.service, currentData.contract, currentData.cleanliness, currentData.specialService, currentData.reception],
           borderColor: '#7aa2ff',
           backgroundColor: '#7aa2ff20',
           borderWidth: 3,
           borderDash: [5, 5],
           pointBackgroundColor: '#7aa2ff',
           pointBorderColor: '#fff',
           pointHoverBackgroundColor: '#fff',
           pointHoverBorderColor: '#7aa2ff'
         });
       }

      currentChart.data.datasets = datasets;
      currentChart.update();
    }

    // ä¿å­˜è¯„åˆ†
    function saveScore() {
      if (!selectedCenter) {
        showToast('è¯·å…ˆé€‰æ‹©ä¼šæ‰€', 'error');
        return;
      }

             const score = {
         id: Date.now(),
         center: selectedCenter,
         medical: parseFloat(document.getElementById('medicalScore').value),
         nursing: parseFloat(document.getElementById('nursingScore').value),
         environment: parseFloat(document.getElementById('environmentScore').value),
         food: parseFloat(document.getElementById('foodScore').value),
         babyCare: parseFloat(document.getElementById('babyCareScore').value),
         service: parseFloat(document.getElementById('serviceScore').value),
         contract: parseFloat(document.getElementById('contractScore').value),
         cleanliness: parseFloat(document.getElementById('cleanlinessScore').value),
         specialService: parseFloat(document.getElementById('specialServiceScore').value),
         reception: parseFloat(document.getElementById('receptionScore').value),
         notes: document.getElementById('notes').value,
         timestamp: new Date().toISOString()
       };

      scoreHistory.push(score);
             saveData();
       updateHistoryDisplay();
       updateRankingDisplay();
       updateChart();
       resetForm();
       showToast('è¯„åˆ†å·²ä¿å­˜');
    }

         // é‡ç½®è¡¨å•
     function resetForm() {
       const scores = ['medical', 'nursing', 'environment', 'food', 'babyCare', 'service', 'contract', 'cleanliness', 'specialService', 'reception'];
       scores.forEach(score => {
         document.getElementById(score + 'Score').value = 5;
         document.getElementById(score + 'Value').textContent = '5';
       });
       document.getElementById('notes').value = '';
       updateChart();
     }

    // æ’¤é”€ä¸Šæ¬¡æ“ä½œ
    function undoLast() {
      if (scoreHistory.length === 0) {
        showToast('æ²¡æœ‰å¯æ’¤é”€çš„è®°å½•', 'error');
        return;
      }

             scoreHistory.pop();
       saveData();
       updateHistoryDisplay();
       updateRankingDisplay();
       updateChart();
       showToast('å·²æ’¤é”€ä¸Šæ¬¡è¯„åˆ†');
    }

         // æ›´æ–°å†å²æ˜¾ç¤º
     function updateHistoryDisplay() {
       const historyList = document.getElementById('historyList');
       
       if (scoreHistory.length === 0) {
         historyList.innerHTML = `
           <div class="empty-state">
             <div class="icon">ğŸ“</div>
             <div>æš‚æ— è¯„åˆ†è®°å½•</div>
             <div style="font-size:13px;margin-top:8px;">å¼€å§‹è¯„åˆ†åï¼Œå†å²è®°å½•å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</div>
           </div>
         `;
         return;
       }

       const historyHTML = scoreHistory.slice().reverse().map(record => {
         const date = new Date(record.timestamp);
         const timeStr = date.toLocaleString('zh-CN');
         const avgScore = ((record.medical + record.nursing + record.environment + record.food + record.babyCare + record.service + record.contract + record.cleanliness + record.specialService + record.reception) / 10).toFixed(1);
         
         return `
           <div class="history-item" onclick="loadRecord(${record.id})">
             <div class="history-time">${timeStr}</div>
             <div class="history-summary">
               <strong>${record.center}</strong> - å¹³å‡åˆ†: ${avgScore} 
               (åŒ»ç–—:${record.medical} | æŠ¤ç†:${record.nursing} | ç¯å¢ƒ:${record.environment} | é¤é£Ÿ:${record.food} | å©´å„¿æŠ¤ç†:${record.babyCare})
             </div>
             ${record.notes ? `<div style="font-size:12px;color:var(--muted);margin-top:4px;">${record.notes.substring(0, 50)}${record.notes.length > 50 ? '...' : ''}</div>` : ''}
           </div>
         `;
       }).join('');

       historyList.innerHTML = historyHTML;
     }

     // æ›´æ–°æ’åæ˜¾ç¤º
     function updateRankingDisplay() {
       const rankingList = document.getElementById('rankingList');
       
       if (scoreHistory.length === 0) {
         rankingList.innerHTML = `
           <div class="empty-state">
             <div class="icon">ğŸ†</div>
             <div>æš‚æ— è¯„åˆ†æ•°æ®</div>
             <div style="font-size:13px;margin-top:8px;">å¼€å§‹è¯„åˆ†åï¼Œæ’åå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</div>
           </div>
         `;
         return;
       }

       // è®¡ç®—æ¯ä¸ªä¼šæ‰€çš„æœ€æ–°è¯„åˆ†
       const centerScores = {};
       scoreHistory.forEach(record => {
         if (!centerScores[record.center] || record.timestamp > centerScores[record.center].timestamp) {
           centerScores[record.center] = record;
         }
       });

       // è®¡ç®—æ€»åˆ†å¹¶æ’åº
       const rankings = Object.values(centerScores).map(record => {
         const totalScore = record.medical + record.nursing + record.environment + record.food + record.babyCare + 
                           record.service + record.contract + record.cleanliness + record.specialService + record.reception;
         const avgScore = (totalScore / 10).toFixed(1);
         
         return {
           ...record,
           totalScore,
           avgScore
         };
       }).sort((a, b) => b.totalScore - a.totalScore);

       // ç”Ÿæˆæ’åHTML
       const rankingHTML = rankings.map((record, index) => {
         const rank = index + 1;
         let rankClass = 'other';
         let itemClass = '';
         
         if (rank === 1) {
           rankClass = 'gold';
           itemClass = 'gold';
         } else if (rank === 2) {
           rankClass = 'silver';
           itemClass = 'silver';
         } else if (rank === 3) {
           rankClass = 'bronze';
           itemClass = 'bronze';
         }

         // è®¡ç®—å„ç»´åº¦å¾—åˆ†æƒ…å†µ
         const scores = [
           { name: 'åŒ»ç–—', score: record.medical },
           { name: 'æŠ¤ç†', score: record.nursing },
           { name: 'ç¯å¢ƒ', score: record.environment },
           { name: 'é¤é£Ÿ', score: record.food },
           { name: 'å©´å„¿æŠ¤ç†', score: record.babyCare },
           { name: 'æœåŠ¡', score: record.service },
           { name: 'åˆåŒ', score: record.contract },
           { name: 'å«ç”Ÿ', score: record.cleanliness },
           { name: 'ç‰¹è‰²', score: record.specialService },
           { name: 'æ¥å¾…', score: record.reception }
         ];

         const scoreTags = scores.map(item => {
           let tagClass = 'medium';
           if (item.score >= 8) tagClass = 'high';
           else if (item.score <= 5) tagClass = 'low';
           
           return `<span class="score-tag ${tagClass}">${item.name}:${item.score}</span>`;
         }).join('');

         return `
           <div class="ranking-item ${itemClass}" onclick="loadRecord(${record.id})">
             <div class="rank-number ${rankClass}">${rank}</div>
             <div class="ranking-info">
               <div class="ranking-title">${record.center}</div>
               <div class="ranking-score">æ€»åˆ†: ${record.totalScore} | å¹³å‡åˆ†: ${record.avgScore}</div>
               <div class="ranking-details">
                 ${scoreTags}
               </div>
             </div>
           </div>
         `;
       }).join('');

       rankingList.innerHTML = rankingHTML;
     }

    // åŠ è½½è®°å½•åˆ°è¡¨å•
    function loadRecord(id) {
      const record = scoreHistory.find(r => r.id === id);
      if (!record) return;

      selectedCenter = record.center;
      document.getElementById('centerSelect').value = record.center;
      document.getElementById('scoreForm').style.display = 'block';
      
             document.getElementById('medicalScore').value = record.medical;
       document.getElementById('nursingScore').value = record.nursing;
       document.getElementById('environmentScore').value = record.environment;
       document.getElementById('foodScore').value = record.food;
       document.getElementById('babyCareScore').value = record.babyCare;
       document.getElementById('serviceScore').value = record.service;
       document.getElementById('contractScore').value = record.contract;
       document.getElementById('cleanlinessScore').value = record.cleanliness;
       document.getElementById('specialServiceScore').value = record.specialService;
       document.getElementById('receptionScore').value = record.reception;
       document.getElementById('medicalValue').textContent = record.medical;
       document.getElementById('nursingValue').textContent = record.nursing;
       document.getElementById('environmentValue').textContent = record.environment;
       document.getElementById('foodValue').textContent = record.food;
       document.getElementById('babyCareValue').textContent = record.babyCare;
       document.getElementById('serviceValue').textContent = record.service;
       document.getElementById('contractValue').textContent = record.contract;
       document.getElementById('cleanlinessValue').textContent = record.cleanliness;
       document.getElementById('specialServiceValue').textContent = record.specialService;
       document.getElementById('receptionValue').textContent = record.reception;
      document.getElementById('notes').value = record.notes || '';
      
      updateChart();
    }

    // å¯¼å‡ºæ•°æ®
    function exportData() {
      const dataStr = JSON.stringify(scoreHistory, null, 2);
      const dataBlob = new Blob([dataStr], {type: 'application/json'});
      const url = URL.createObjectURL(dataBlob);
      const link = document.createElement('a');
      link.href = url;
      link.download = `æœˆå­ä¼šæ‰€è¯„åˆ†è®°å½•_${new Date().toISOString().split('T')[0]}.json`;
      link.click();
      URL.revokeObjectURL(url);
      showToast('æ•°æ®å·²å¯¼å‡º');
    }

    // å¯¼å…¥æ•°æ®
    function importData() {
      document.getElementById('fileInput').click();
    }

    // å¤„ç†æ–‡ä»¶å¯¼å…¥
    function handleFileImport(event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const importedData = JSON.parse(e.target.result);
                     scoreHistory = importedData;
           saveData();
           updateHistoryDisplay();
           updateRankingDisplay();
           updateChart();
           showToast('æ•°æ®å¯¼å…¥æˆåŠŸ');
        } catch (error) {
          showToast('æ–‡ä»¶æ ¼å¼é”™è¯¯', 'error');
        }
      };
      reader.readAsText(file);
      event.target.value = '';
    }

    // æ¸…ç©ºæ‰€æœ‰æ•°æ®
    function clearAllData() {
      if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰è¯„åˆ†è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚')) {
                 scoreHistory = [];
         saveData();
         updateHistoryDisplay();
         updateRankingDisplay();
         updateChart();
         showToast('æ‰€æœ‰æ•°æ®å·²æ¸…ç©º');
      }
    }

    // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
    function saveData() {
      localStorage.setItem('maternityCenterScores', JSON.stringify(scoreHistory));
    }

    // ä»æœ¬åœ°å­˜å‚¨åŠ è½½
    function loadData() {
      const saved = localStorage.getItem('maternityCenterScores');
      if (saved) {
                 try {
           scoreHistory = JSON.parse(saved);
           updateHistoryDisplay();
           updateRankingDisplay();
         } catch (error) {
           console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
         }
      }
    }

    // æ˜¾ç¤ºæç¤º
    function showToast(message, type = 'success') {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.className = `toast ${type}`;
      toast.classList.add('show');
      
      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }
  </script>
</body>
</html> 